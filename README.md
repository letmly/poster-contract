# Polygon Box

## Описание

Polygon Box — это шаблон для разработки, который предоставляет необходимую структуру для начала работы с решением Ethereum L2 от Polygon, известным как Polygon PoS chain (ранее Matic PoS chain). Этот проект включает в себя базовый контракт SimpleStorage и предназначен для того, чтобы помочь разработчикам быстро начать работу с Polygon PoS без необходимости писать сложные приложения.

## Требования

Для работы с Polygon Box необходимы следующие компоненты:

- [Node.js](https://nodejs.org/) версии 10.x или выше
- [NPM](https://docs.npmjs.com/cli/) версии 5.2 или выше
- Операционная система: Windows, Linux или MacOS

Полезно, но не обязательно:

- Учетная запись и Project ID на [Infura](https://infura.io/)
- Учетная запись на [MetaMask](https://metamask.io/)

## Установка

Чтобы установить проект, выполните следующую команду:

```bash
truffle unbox polygon
```

## Настройка

### Использование файла .env

Для работы с сетью вам понадобится как минимум один мнемоник. Пакет `.dotenv` уже установлен, и вам нужно создать файл `.env` для хранения вашего мнемоника и другой необходимой конфиденциальной информации.

Файл `.env` игнорируется Git в этом проекте, чтобы защитить ваши личные данные. Важно избегать коммита информации о ваших приватных ключах в GitHub. Файл `truffle-config.polygon.js` ожидает, что в `.env` будет значение `MNEMONIC` для выполнения миграций на указанных сетях.

Если вы не знакомы с использованием `.env` для управления вашими мнемониками и другими ключами, выполните следующие шаги:

1. Создайте файл `.env` в корне вашего проекта с помощью команды:
   ```bash
   touch .env
   ```
2. Откройте файл `.env` в вашем любимом IDE.
3. Добавьте следующее, заполнив свои данные:
   ```
   MNEMONIC="<Ваш Мнемоник>"
   INFURA_PROJECT_ID="<Ваш Infura Project ID>"
   ```

4. В процессе разработки вы можете добавлять любую другую конфиденциальную информацию в этот файл. Вы можете получить к ней доступ из других файлов с помощью `require('dotenv').config()` и ссылаться на переменные с помощью `process.env['<ВАША_ПЕРЕМЕННАЯ>']`.

### Новый конфигурационный файл

В этом проекте существует новый конфигурационный файл: `truffle-config.polygon.js`. Этот файл содержит ссылку на новое местоположение `contracts_build_directory` для контрактов Polygon PoS и перечисляет несколько сетей, работающих на Polygon PoS Layer 2 (см. ниже).

Обратите внимание, что классический файл конфигурации `truffle-config.js` также включен, так как вам в конечном итоге потребуется развернуть контракты и на Ethereum. Все обычные команды Truffle (`truffle compile`, `truffle migrate` и т.д.) будут использовать этот конфигурационный файл и сохранять собранные файлы в `build/ethereum-contracts`. Вы можете сохранять контракты Solidity, которые хотите развернуть на Ethereum, в папке `contracts/ethereum`.

### Новая структура каталогов для артефактов

Когда вы компилируете или мигрируете, результирующие файлы `json` будут находиться в `build/polygon-contracts/`. Это сделано для того, чтобы отличать их от любых Ethereum контрактов, которые вы создаете, которые будут находиться в `build/ethereum-contracts`. Поскольку мы включили соответствующий `contracts_build_directory` в каждый конфигурационный файл, Truffle будет знать, какой набор собранных файлов использовать!

## Polygon PoS Chain

### Компиляция

Вам не нужно добавлять новые компиляторы или настройки для компиляции ваших контрактов для Polygon PoS chain, так как он полностью совместим с EVM. Файл конфигурации `truffle-config.polygon.js` указывает пути к контрактам и сборкам для контрактов, предназначенных для Polygon.

Если вы компилируете контракты специально для сети Polygon PoS, используйте следующую команду:

```bash
npm run compile:polygon
```

Если вы хотите повторно скомпилировать ранее скомпилированные контракты, вы можете вручную запустить эту команду с помощью:
```bash
truffle compile --config=truffle-config.polygon.js --all
```

### Миграция

Чтобы мигрировать на сеть Polygon PoS, выполните команду:
```bash
npm run migrate:polygon --network=(polygon_infura_testnet | polygon_infura_mainnet)
```
(не забудьте выбрать одну из сетей!)

Как вы можете видеть, у вас есть несколько сетей Polygon PoS L2 на выбор:

- **Сети Infura**. Infura запускает узел тестовой сети, а также узел основной сети для Polygon PoS chain. Развертывание на этих сетях требует, чтобы вы зарегистрировались в Infura и инициировали проект. Подробности можно найти на сайте Infura.

В файле конфигурации `truffle-config.polygon.js` указаны следующие сети Infura:
- `polygon_infura_testnet`: Тестовая сеть Infura Polygon PoS.
- `polygon_infura_mainnet`: Основная сеть Infura Polygon PoS. Осторожно! Если вы развернете на этой сети, используя подключенный кошелек, сборы будут взиматься в основной сети MATIC.

Если вы хотите мигрировать ранее мигрированные контракты на той же сети, вы можете выполнить команду:
```bash
truffle migrate --config truffle-config.polygon.js --network=(polygon_infura_testnet | polygon_infura_mainnet) --reset
```

### Оплата за миграции

Чтобы оплатить ваши развертывания, вам нужно иметь учетную запись с ETH, доступным для расходования. Вам понадобится ваш мнемоник (сохраненный в файле `.env` или другим безопасным способом). Первый аккаунт, сгенерированный из семени, должен иметь ETH, необходимый для развертывания. Для справки, тестовые сети Polygon PoS основаны на Goerli, поэтому вы сможете использовать Goerli ETH.

Если у вас нет кошелька с достаточным количеством средств для развертывания, вам нужно будет подключить кошелек к хотя бы одной из вышеуказанных сетей. Для тестирования это означает, что вам нужно будет подключить кошелек к сети `polygon_infura_testnet`. Мы рекомендуем использовать [MetaMask](https://metamask.io/).

Документация о том, как настроить пользовательские сети MetaMask с сетью Polygon PoS, доступна [здесь](https://docs.matic.network/docs/develop/metamask/config-matic).

Чтобы получить тестовые ETH, посетите краны, такие как [https://goerli-faucet.slock.it/](https://goerli-faucet.slock.it/).

## Основные команды

Код здесь позволит вам компилировать, мигрировать и тестировать ваш код против экземпляра сети Polygon PoS. Следующие команды могут быть выполнены (более подробная информация о каждой команде будет представлена в следующем разделе):

Для компиляции:
```bash
npm run compile:polygon
```

Для миграции:
```bash
npm run migrate:polygon --network=(polygon_infura_testnet | polygon_infura_mainnet)
```

Для тестирования:
```bash
npm run test:polygon --network=(polygon_infura_testnet | polygon_infura_mainnet)
```

### Тестирование

Чтобы запустить тест, который сейчас находится в шаблоне, используйте следующую команду:
```bash
npm run test:polygon --network=(polygon_infura_testnet | polygon_infura_mainnet)
```
(не забудьте выбрать сеть!). Текущий тестовый файл содержит некоторые базовые тесты, чтобы помочь вам начать. Вам, вероятно, нужно будет добавить специфические для сети тесты, чтобы убедиться, что ваши контракты работают как ожидалось.

### Связь между Ethereum и Polygon PoS Chains

Информация выше должна позволить вам развернуть на Polygon PoS Layer 2 chain. Это только первый шаг! Как только вы будете готовы развернуть свои собственные контракты для работы на L1 с использованием L2, вам нужно будет знать о [способах взаимодействия между Layer 1 и Layer 2 в экосистеме Polygon](https://docs.matic.network/docs/develop/ethereum-matic/getting-started). Следите за дополнительными инструментами Truffle и примерами, которые прояснят этот второй шаг к полной интеграции Polygon PoS L2!

## Поддержка

Поддержка для этого шаблона доступна через сообщество Truffle [здесь](https://www.trufflesuite.com/community).
